<!DOCTYPE html>
<html lang="zh-CN" class="pixel-ratio-1">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title></title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <meta name="full-screen" content="yes">
    <meta name="x5-fullscreen" content="true">
    <link rel="stylesheet" href="__STATIC__/common/css/wx.css">
    <link rel="stylesheet" href="__STATIC__/common/lib/vant/css/index.css"/>
    <link rel="stylesheet" href="__STATIC__/muban1/css/main.css?3">
    <script src="__STATIC__/common/lib/vue/vue.js"></script>
    <script src="__STATIC__/common/lib/vant/js/vant.min.js"></script>
    <script src="__STATIC__/common/js/jquery.min.js"></script>
    <script src="__STATIC__/common/lib/layer/layer.js"></script>
    <script src="__STATIC__/common/js/base64.min.js"></script>
    <script src="__STATIC__/common/js/xgplayer/index.js" charset="utf-8"></script>
    <script src="__STATIC__/common/js/xgplayer/index.flv.js" charset="utf-8"></script>
    <script src="__STATIC__/common/js/xgplayer/index.hls.js" charset="utf-8"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.documentElement.style.fontSize = document.documentElement.clientWidth / 30 + 'px'
        })
    </script>
    <style>
        html,
        body {
            height: 100%;
        }
        .wrap {
            height: 100%;
            background: -webkit-linear-gradient(left,rgb(199,39,231),rgb(24, 224, 197));
        }
        .index{
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .view {
            flex: 1;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
        }
        .v-body {
            min-height: 101%;
            padding-bottom: 0.20rem;
        }
        .pay-item {
            width: 100%;
            height: 40px;
            line-height: 40px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #FF9904;
            text-align: center;
            color: #fff;
            background-color: #FF9904;
        }
        .pay-item:active {
            opacity:0.7;
        }
        .pay-item:last-child {
            margin-bottom: 10px;
        }
        input::-ms-input-placeholder {
            text-align: center;
        }

        input::-webkit-input-placeholder {
            text-align: center;
        }
        #mse {
            background-color: #0d0d0d;
        }
        .player_bot {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -ms-flex-pack: distribute;
            justify-content: space-around;
            margin-top: 1%;
            border-bottom: 1px solid #f2f2f2;
            padding-bottom: 10px;
        }
        .player_bot div {
            font-size: 12px;
            text-align: center;
        }
        .player_bot div img {
            width: 25px;
            height: 25px;
            margin-bottom: 5px;
            margin-top: 5px;
        }
        .details{
            width: 100%;
            padding-top:5px;
            overflow:hidden;
            padding-bottom:15px;
            border-bottom: 1px solid #f2f2f2;
        }
        .details div {
            display: inline-block;
            padding-top: 4px;
        }
        .details img {
            width: 15px;
            height: 15px;
        }
        .weui-panel__hd {
            padding-top: 10px;
        }
        .player_line{
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding:0 5px;
            margin:5px 0;
        }
        .player_line .line_item{
            width:49%;
            height:40px;
            line-height:40px;
            text-align: center;
            color:#A30014;
            border:#A30014 1px solid;
            background-color:#EAD409;
            font-size:14px;
        }
        .player_line .on{
            color:#797979!important;
            border:#797979 1px solid!important;
        }
        .times{
            position: absolute;
            left:2px;
            top:3px;
           background: rgb(16 1 1 / 34%);
            color:#fff;
            padding:1px 6px;
            border-radius:20px;
            font-size:10px;
            z-index:9;
        }
        /*.footer{*/
        /*    width:100%;*/
        /*    position:fixed;*/
        /*    bottom:0;*/
        /*    z-index:9999;*/
        /*    left:0;*/
        /*    height:50px;*/
        /*    background-color:#FFFFFF;*/
        /*    border-top:1px solid #CCCCCC;*/
        /*}*/
        /*.footer ul{*/
        /*    display: flex;*/
        /*    align-items: center;*/
        /*}*/
        /*.footer ul li{*/
        /*    text-align:center;*/
        /*    width:50%;*/
        /*}*/
        /*.footer ul li.active span{*/
        /*    color:rgb(250, 67, 106);*/
        /*}*/
        /*.footer ul li img{*/
        /*    margin-top:5px;*/
        /*    width:20px;*/
        /*    height:20px;*/
        /*}*/
        /*.footer ul li span{*/
        /*    display:block;*/
        /*    width:100%;*/
        /*    color:#555555;*/
        /*    font-size:0.9rem;*/
        /*    text-align:center;*/
        /*}*/
        .foot {
            background: -webkit-linear-gradient(left,rgb(199,39,231),rgb(24, 224, 197));
            height: 3.6rem;
            display: flex;
            align-items: center;
            justify-content: space-around;
            color: #fff;
            font-size: 0.30rem;
        }

        .foot-item {
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0.1rem;
            font-size: 1.5rem;
            width: fit-content;
        }
        .foot-active {
            background-image: linear-gradient(#fffaaa, #fff000) !important;
            color: #da2b30;
            padding: 4px 30px;
            border-radius: 0.5rem;
        }
        .van-clearfix li:nth-child(even) {
            float: right;
        }
    </style>
</head>
<body>
<div id="app" class="wrap root">
    <div class="index">
        <div class="view">
            <div class="v-body">
                <div id="mse" style="height: 240px;width: 100%"></div>
                
                <div class="weui-panel__hd" style="text-align: center">精彩视频推荐</div>
                <div v-if="list.length>0">
                    <div class="list">
                        <van-list v-model="loading" :finished="finished" finished-text="没有更多了" @load="doGetList" offset="150" direction="down">
                            <div class="van-clearfix">
                                <lazy-component>
                                    <li class="list-item" v-for="item in list" @click="doPay(item)">
                                        <div v-if="item.img" class="thumb">
                                            <span class="times" v-if="item.times">时长:{{item.times}}</span>
                                            <img v-lazy="item.img" :src="item.img" width="100%">
                                            <div class="plays">
                                                <span>{{item.money}}元观看</span>
                                                <span>{{item.rand}}人看过</span>
                                            </div>
                                        </div>
                                        <div class="name">{{item.title}}</div>
                                    </li>
                                </lazy-component>
                            </div>
                        </van-list>
                    </div>
                </div>
            </div>
        </div>
        <div class="foot" style="margin-left: -5px;">
            <a class="foot-item foot-active" href="/vlist?ldk={:input('ldk')}">返回</a>
            <!--<div class="foot-item foot-active" onclick="">返回</div>-->
            <div class="foot-item foot-active"  @click="doGetList('pay')">已购</div>
            
        </div>
    </div>
    <!--打赏代码-->
    <div id="WX-window-TKEy5SPt5wisSxt-Shade" v-if="dialog.pay.status" class="WX-window-shade">
        <div id="WX-window-TKEy5SPt5wisSxt-box" class="WX-window-box animated fadeInUp">
            <div class="WX-Window-main" style="width:85%"><h2>打赏后观影</h2>
                <div class="WX-Window-body">
                    <li v-for="(item,index) in dialog.pay.pay" class="pay-item" @click="linkTo(item.url)" v-if="item.flg != 'jf'">
                        <a style="color: black">
                            {{item.name}}
                        </a>
                    </li>
                    <p style="color:#f74550;line-height:25px;margin:10px auto;">
                        温馨提示：推荐用浏览器直接扫码支付方可以保存至《已购》中查，若在微信中跳转支付的，可返回浏览器打开网站中查看。<br>注意：由于观影人数较多，有所异常请多试几次！
                    </p>
                </div>
                <div class="WX-Window-footer">
                    <a @click="dialog.pay.status=false,dialog.pay.pay=[]" href="javascript:void(0);" style="width:calc(95% - 10px);" class="WX-Window-btn cannel">关闭</a>
                </div>
            </div>
        </div>
    </div>
    <!--收藏代码-->
    <div id="WX-window-TKEy5SPt5wisSxt-Shadee" v-if="dialog.fav.status" class="WX-window-shade">
        <div id="WX-window-TKEy5SPt5wisSxt-box1" class="WX-window-box animated fadeInUp">
            <div class="WX-Window-main" style="width:80%"><h2>保存本站</h2>
                <div class="WX-Window-body">
                    <p style="color:#f74550;line-height:25px;margin-top:10px;text-align:center;">
                        长按保存二维码或复制链接收藏本站
                    </p>
                    <img width="100%" :src="'/qrcode?text='+dialog.fav.url" style="display:block;margin:auto;">
                </div>
                <div class="WX-Window-footer">
                    <a @click="dialog.fav.status=false" href="javascript:void(0);" style="width:calc(95% - 10px);" class="WX-Window-btn cannel">关闭</a>
                </div>
            </div>
        </div>
    </div>
</div>
<form action="" method="post" name="form" style="display:none"></form>
<script>
    var play_url='{$link.video_url}';
    Vue.config.productionTip = false;
    Vue.config.lang = 'zh-CN';
    var dy = "{:config('setting.douyin')}";
    var payed = "{$pay}";
    Vue.use(vant.Lazyload, {
        lazyComponent: true,
    });
    vues = new Vue({
        el: '#app',
        data: {
            list: [],
            cat: [],
            banner: [],
            loading: false,
            finished: false,
            my_player:null,
          
            m3u8:'{$m3u8}',
            line_index:0,
            msg: '没有更多了',
            params: {
                ldk: "{:input('ldk')}",
                page: 1,
                limit: 50,
                encode: 1,
                cid: "{:input('cid')}",
                key: "{:input('keyword')}",
                payed: ''
            },
            catParam: {
                limit: 50,
                ldk: "{:input('ldk')}",
                encode: 1,
            },
            dialog: {
                fav: {
                    status: false,
                    url: "",
                },
                pay: {
                    status: false,
                    data: [],
                    pay: []
                }
            }
        },
        mounted: function () {
            // if(this.isjf==1){
            //     setInterval(() => {
            //         this.doFav();
            //     }, 60000);
            // }
            // if(this.m3u8){
            //     this.createPlayer(play_url);
            // }else{
            //     this.createPlayerFrame(play_url);
            // }
            this.createPlayer(play_url);
            this.doGetList();
        },
        methods: {
            //加载框架
            createPlayerFrame(url){
                var str='<iframe src="' + url + '" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen="true" scrolling="no" width="100%" height="100%" frameborder="0"></iframe>';
                $('#mse').html(str);
            },
            createPlayer(url){
                let self=this;
                self.my_player=new Player({
                    "id": "mse",
                    "url": url,
                    "playsinline": true,
                    "poster": "{$link.img}",
                    "x5-video-player-fullscreen": "false",
                    "x5-video-orientation": "portraint",
                    "x5-video-player-type": "h5",
                    "fluid": true,
                    "videoInit": true,
                    "playbackRate": [0.5, 0.75, 1, 1.5, 2],
                    "closeVideoClick":true,
                    "closeVideoTouch":true
                });
                self.my_player.on('timeupdate', function (e) {
                    var currentTime = parseInt(e.currentTime);
                    var try_see = "{$link.try_see}";
                    if (currentTime >= try_see) {
                        if (payed == 0) {
                            e.pause();
                            vues.try_see({
                                id: "{$link.id}",
                                pay: 0,
                                money: "{$link.money}"
                            });
                        }
                    }
                });
            },

            try_see(item) {
                vant.Dialog.confirm({
                    title: '试看',
                    message: '试看以结束，请点击打赏观看完整视频',
                    cancelButtonText: "我在选选",
                    confirmButtonText: "打赏观看"

                }).then(() => {
                    this.doPay(item)
                }).catch(() => {
                    // on cancel
                });
            },
            doRate() {
                return parseInt(Math.random() * (10000 - 90) + 90);
            },
            linkTo(e) {
                layer.msg("正在吊起支付...", {
                    icon: 16,
                    time: -1
                });
                if (dy == "1") {
                    document.form.action = e;
                    document.form.submit();
                    return
                }
                location.href = e;
            },
           
            doPay(item) {
                let vm = this;
                vm.vid = item.id;
                if (item.pay == 1) {
                    window.location.href = item.url;
                    return;
                }
                $.ajax({
                    url: "/api/resource/play?ldk={:input('ldk')}&vid=" + item.id + "&money=" + item.money,
                    type: 'GET',
                    dataType: 'JSON',
                    data: {},
                    complete: function (XMLHttpRequest, textStatus) {
                    },
                    success: function (res) {
                        if (res.code === 200) {
                            vm.dialog.pay.pay = res.data;
                            vm.dialog.pay.status = true;
                        } else {
                            layer.msg(res.msg);
                        }
                    }
                });
            },
            doGetList(pay) {
                let vm = this;
                vm.loading = true;
                if (pay == "pay") {
                    vm.params.page = 1;
                    vm.params.payed = 1;
                    vm.list = [];
                }
                $.ajax({
                    url: '/api/resource/getList',
                    type: 'GET',
                    dataType: 'JSON',
                    data: vm.params,
                    complete: function (XMLHttpRequest, textStatus) {
                    },
                    success: function (res) {
                        if (res.code == 200) {
                            let temp = res.data.list;
                            if(vm.params.encode==1){
                                temp = JSON.parse(Base64.decode(res.data.list));
                            }
                            vm.params.page++;
                            vm.list = vm.list.concat(temp);
                            vm.loading = false;
                            if (vm.list.length == res.data.total) {
                                vm.finished = true;
                            }
                        } else {
                            layer.alert(data.msg);
                        }
                    }
                });
            },
            doFav() {
                let vm = this;
                vm.dialog.fav.url = "{$fav}";
                vm.dialog.fav.status = true;
            },
            
        }
    });

</script>
</body>
</html>